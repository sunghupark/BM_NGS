###[trimming] 
(venv) (base) bm@BM:/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/rawdata$
/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/TrimGalore-0.6.10/trim_galore -j 4 -o /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/ --fastqc_arg "-4 --outdir /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/Fastqc/" D_C.fastq.gz ;
/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/TrimGalore-0.6.10/trim_galore -j 4 -o /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/ --fastqc_arg "-4 --outdir /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/Fastqc/" D_I.fastq.gz 

###[bowtie2]아무 디렉토리에서. -> indexes/hg38/hg38 디렉토리 만들어주기.
bowtie2 -p 2 --very-sensitive -x /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/indexes/hg38/hg38 -X 1000 -U /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/D_C_trimmed.fq.gz -S D_C_trimmed.sam ; 
bowtie2 -p 2 --very-sensitive -x /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/indexes/hg38/hg38 -X 1000 -U /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/D_I_trimmed.fq.gz -S D_I_trimmed.sam

###[samtools view]
samtools view -@ 2 -S -bh -q 10 -F 1804 - D_C_trimmed.sam D_C_trimmed.bam ;
samtools view -@ 2 -S -bh -q 10 -F 1804 - D_I_trimmed.sam D_I_trimmed.bam

###[samtools sort]
samtools sort -@ 2 -m 24G -o /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/aligned/D_C_trimmed_sorted.bam /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/D_C_trimmed.bam ;
samtools sort -@ 2 -m 24G -o /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/aligned/D_I_trimmed_sorted.bam /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/trimmed/D_I_trimmed.bam

###[picard]
java -jar /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/picard.jar MarkDuplicates I=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/aligned/D_C_trimmed_sorted.bam O=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed_duprm.bam M=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed_marked_dup_metrics.txt ;
java -jar /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/picard.jar MarkDuplicates I=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/aligned/D_I_trimmed_sorted.bam O=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed_duprm.bam M=/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed_marked_dup_metrics.txt
-> chat의 도움을 받음, nano mark_duplicates.sh라고 치고 시작, chmod -x mark_duplicates.sh까지 써야댐. 실행은 ./mark_duplicates.sh로.

# hg38-blacklist.bed.gz 다운 받기
samtools view -h -@ 2 /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed_duprm.bam | egrep -v chrM | samtools view -bh -@ 2 - | bedtools intersect -abam stdin -b /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/blacklist/hg38-blacklist.bed.gz -v > /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed.duprm_rmChrM_rmBlack.bam ;
samtools view -h -@ 2 /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed_duprm.bam | egrep -v chrM | samtools view -bh -@ 2 - | bedtools intersect -abam stdin -b /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/blacklist/hg38-blacklist.bed.gz -v > /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed.duprm_rmChrM_rmBlack.bam

rm /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed_sorted_duprm.bam ;
rm /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed_sorted_duprm.bam

###[macs3] -> 그냥 바로 넣음 duprm 파일에서. -B : BedGraph가 .bdg로 나옴.
macs3 callpeak -t /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_C_trimmed_sorted_duprm_rmChrM_rmBlack.bam -c /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/D_I_trimmed_sorted_duprm_rmChrM_rmBlack.bam -f BAM -g mm -n DROSHA_HeLa -B -q 0.05

###[bedGraphToBigWig] -> bdg는 파일이 macs3에서 두개가 나오는데 그냥 각각 bigwig으로 바꾸고, intersect 볼때는 treat만 보면 될 것 같다. mll2_drosha_colocal/chromsizes/hg38.chrom.sizes 만들기
/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/bedGraphToBigWig /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/DROSHA_HeLa_treat_pileup.bdg /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/chromsizes/hg38.chrom.sizes /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/DROSHA_HeLa_treat_pileup.bw ; \
/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/bedGraphToBigWig /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/DROSHA_HeLa_control_lambda.bdg /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/chromsizes/hg38.chrom.sizes /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/DROSHA_HeLa_control_lambda.bw

###[Homer - motif analysis] 하나당 30분 이상. 052523 연구노트 참조.
/media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/Tools/HOMER/bin/findMotifsGenome.pl /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/duprm/DROSHA_HeLa_summits.bed hg38 /media/bm/790240e4-2887-451f-ad02-1b19c4b4e120/PSH/mll2_drosha_colocal/homermotifresult/mll2_homermotifresult
